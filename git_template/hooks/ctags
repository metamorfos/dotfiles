#!/bin/sh
set -e

PATH="/usr/local/bin:$PATH"
dir="$(git rev-parse --git-dir)"

trap 'rm -f "$dir/$$.tags"' EXIT

if [ -f Gemfile ] && which ripper-tags >/dev/null; then
  git ls-files --cached --exclude-standard --others | \
    ripper-tags --tag-relative -L - -f "$dir/$$.tags"
else
  git ls-files --cached --exclude-standard --others | \
    ctags --tag-relative -L - -f "$dir/$$.tags"
fi

mv "$dir/$$.tags" "$dir/tags"
